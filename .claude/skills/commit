#!/bin/bash
# Skill: commit
# Description: Commit changes made by Claude with a descriptive message

set -euo pipefail

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
  echo "Error: Not in a git repository"
  exit 1
fi

# Check if there are any changes to commit
if git diff --quiet && git diff --cached --quiet; then
  echo "No changes to commit"
  exit 0
fi

# Get list of changed files
changed_files=$(git diff --name-only)
staged_files=$(git diff --cached --name-only)

# Combine and show all modified files
all_files=$(echo -e "$changed_files\n$staged_files" | sort -u | grep -v '^$' || true)

if [ -z "$all_files" ]; then
  echo "No changes to commit"
  exit 0
fi

echo "Files modified by Claude:"
echo "$all_files" | sed 's/^/  - /'
echo

# Stage all changes
git add -A

# Generate commit message based on files changed
file_count=$(echo "$all_files" | wc -l | tr -d ' ')

if [ "$file_count" -eq 1 ]; then
  # Single file - use specific message
  filename=$(echo "$all_files" | head -1)

  # Check if file is new or modified
  if git ls-files --error-unmatch "$filename" > /dev/null 2>&1; then
    action="Update"
  else
    action="Create"
  fi

  commit_msg="$action: $filename

Modified by Claude Code"
else
  # Multiple files - use summary message
  commit_msg="Update multiple files

Files modified by Claude Code:
$(echo "$all_files" | sed 's/^/- /')

Total: $file_count files"
fi

# Create the commit
git commit -m "$commit_msg"

echo
echo "âœ“ Changes committed successfully"
git log -1 --oneline
